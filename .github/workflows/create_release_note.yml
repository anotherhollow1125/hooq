name: Create Release Note
on:
  push:
    tags:
      - 'v*.*.*'
jobs:
  create_release_note:
    runs-on: ubuntu-latest
    outputs:
      included-files-list: ${{ steps.included-files-list.outputs }}
    steps:
      - uses: actions/checkout@v5
      - name: Obtain Included Files List
        id: included-files-list
        run: |
          helpers="$(cargo package --list -p hooq-helpers)"
          macros="$(cargo package --list -p hooq-macros)"
          hooq="$(cargo package --list -p hooq)"
          cat <<EOF >> "$GITHUB_OUTPUT"
          <details>
          <summary>Files included in hooq-helpers</summary>

          $(echo "$helpers" | tr ' ' '\n' | sed -e 's/^/- /g')

          </details>
          <details>
          <summary>Files included in hooq-macros</summary>

          $(echo "$macros" | tr ' ' '\n' | sed -e 's/^/- /g')

          </details>
          <details>
          <summary>Files included in hooq</summary>

          $(echo "$hooq" | tr ' ' '\n' | sed -e 's/^/- /g')

          </details>
          EOF
      - name: Create Release Note
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG: ${{ github.ref_name }}
        run: |
          gh release create "$TAG" --draft \
            --generate-notes \
            --notes "Included files in this release:\n\n${{ steps.included-files-list.outputs }}"