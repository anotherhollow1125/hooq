name: Create Release Note
on:
  push:
    tags:
      - 'v*.*.*'
jobs:
  create_release_note:
    runs-on: ubuntu-latest
    outputs:
      included-files-list: ${{ steps.included-files-list.outputs }}
    steps:
      - uses: actions/checkout@v5
      - name: Obtain Included Files List
        id: included-files-list
        run: |
          helpers="$(cargo package --list -p hooq-helpers)"
          macros="$(cargo package --list -p hooq-macros)"
          hooq="$(cargo package --list -p hooq)"
          {
            echo "<details>"
            echo "<summary>Files included in hooq-helpers</summary>"
            echo
            echo "$helpers" | tr ' ' '\n' | sed -e 's/^/- /g'
            echo
            echo "</details>"
            echo "<details>"
            echo "<summary>Files included in hooq-macros</summary>"
            echo
            echo "$macros" | tr ' ' '\n' | sed -e 's/^/- /g'
            echo
            echo "</details>"
            echo "<details>"
            echo "<summary>Files included in hooq</summary>"
            echo
            echo "$hooq" | tr ' ' '\n' | sed -e 's/^/- /g'
            echo
            echo "</details>"
          } >> "$GITHUB_OUTPUT"
      - name: Create Release Note
        run: |
          gh release create "$GITHUB_REF" --draft \
            --generate-notes \
            --notes "Included files in this release:\n\n${{ steps.included-files-list.outputs }}"