# todo

- [x] 関数の `return` をつけていない返り値にも対応する
- [x] 特殊文法に対応
  - [x] `$expr`: フックする対象式の内容をそのまま出力
  - [x] `$nth` / `$count`: 何番目の `?` / `return` かと、その種別を示す
    - 最後の返り値である場合はそのことも示す
  - [x] `$tag`: タグがある場合にそれを出力。ない場合は `(no tag)` を出力
    - あらかた実装はできたのでチェックを入れた
  - [x] `$line`: 行番号を出力 ( `nightly` では正確な位置、 `stable` では `line!()` を利用 )
    - Span情報を利用
  - [x] `$file`: ファイル名を出力
    - ~~Span情報を利用~~
    - ~~`file!()` マクロでも可で、同じ結果が得られると考えられるが、一応仕組みが異なる~~
      - ~~将来的にモジュールにもouter attributeで付与できる機能を導入する場合、 `Span` 情報を利用した場合との差が出ると考えられる~~
      - `nightly` だけならばいざ知らず、 `procmacro2_semver_exempt` が必要になったためただのエイリアスにすること決定！
  - [x] `$fn`: 関数の情報を出力
    - [x] ~~`$fn_pos`: 関数の位置を出力。仕組みは `line!()` を利用~~
      - `$line` ( `line!()` ) を活用すれば良いため使用しないこととした
    - [x] `$fn_name`: 関数名を出力
    - [x] `$fn_sig`: 関数のシグネチャを出力
    - [x] ~~`$fn_path`: 関数のパスを出力~~
      - 取得難易度が高い & `$file` ( `file!()` ) を活用すれば良いため使用しないこととした
- [x] テストを用意し始める
- [x] `skip` を `skip_all` か `ignore_all` に、部分的に無視するものを `skip` にする
  - [x] 伴い、 `skip` したときに内側のアトリビュートが残ってしまわないように直す
  - [x] `skip` / `skip_all` 用のテストを用意
  - [x] `skip` の仕様を詰める
    - スコープ単位での調整が吉？ -> そうした
  - [x] skip のテストを全部の構文要素について用意
- [x] `$expr` の挙動を直す
  - `#[cfg(all())]` や実際に付与されたフックなどマクロの副作用を受けてしまっているので、副作用を受けていないものをなんとかして取得したい
  - 属性は出力しない
  - `$expr` の元となるものを取得するタイミングを考える
    - 再帰呼び出し前に持ってくる
- [x] ~~verbose/depth 的なオプションを設定~~
  - ~~当初は全部につけるようにしていたけどこれだと表示がうるさいので表面だけ/全部につけるを付け替えたい~~
  - ~~伴い、 `#[hooq::force]` がある場合は絶対につけるみたいなオプションがほしい~~
  - 一晩考えたけどやっぱり全部につける & 要らない所は `#[hooq::skip]` かなぁ...
  - 局所的に出力を飛ばすオプションはほしい...？
- [ ] use_ の実装 (プリセットの用意)
- [ ] デフォルトでは debug 時のみ出力とし、 release 時出力を指定するためのオプションを設ける
- [x] メソッドを文中アトリビュートでの指定にも対応 (メソッドオーバーライド)
- [x] tag などについてルートとなる関数でも対応 (機能追加に時間がかかりそうだったため一旦TODOとした。該当箇所にTODOをつけている)
  - `tag` だけ先に対応済みだった。下のタスクを行うこと
- [ ] `HooqOption` を `Context` に統合する
- 現状は関数に対しての outer attribute としてのみ
  - [ ] モジュールへの outer attribute / inner attribute に対応する
  - この場合の挙動は、モジュール内でトップに定義された全ての関数へのフック付与
    - ~~上述の `$file` 変数について、作り方次第では杞憂で終わる可能性もあるため、YAGNIを破る感じにはなる...~~
    - その作り方次第の詳細: `#[hooq]` により `#[hooq]` を関数の属性としてつける場合問題なくなる可能性。検証してみないとわからないけども(多分無理)
    - [x] 上述の通りとしたのでモジュールに outer attribute として付与した場合、正確な位置を示さなくなる可能性が出てきた。要検証
      - `Span::line` 等を使うようになってきたのとテストを増やしたのでとりあえず大丈夫とする
- [x] ~~悩んでいる機能: `#[hooq::force]`~~
  - ~~強制的に付与することを示すアトリビュート~~
  - ~~でもこういうことしたいなら明示的に書いたほうが良いのでは...？~~
  - ~~もっとも、hooqの設定をそのまま適用させたいみたいなニーズには答えられそうではある~~
  - ~~ `#[hooq::skip_all]` 中に強制付与できるのは普通に強いので、入れても良いような気はしている~~
  - `#[hooq::skip]` を直感的にわかりやすいスコープ管理のものとしたため、必須ではなくした
  - 後述しているが、 `Result` だけでなく `MyResult` に対応できたり、 `Ok` へのフックのオンオフができたりを、オプションで表現したい
    - これができれば `#[hooq::force]` は不要と考えられる
- [x] `#[cfg(all())]` も残さないようにする
- [x] マクロの中も見るようにする
- ~~以下は余力があれば~~
- ~~[ ] `$mod`: モジュールの情報を出力~~
  - ~~[ ] `$mod_name`: モジュール名を出力~~
  - ~~[ ] `$mod_path`: モジュールのパスを出力~~
- ~~[ ] `$crate`: クレートの情報を出力~~
  - ~~[ ] `$crate_name`: クレート名を出力~~
  - ~~[ ] `$crate_path`: クレートのパスを出力~~
- [x] nightly を外す
- [x] `$file` について、絶対パスではなく相対パスを指定するバリエーションのものも用意
  - `Span::file` を利用する形にしたところ逆になった ( `Cargo.toml` があるとき相対パスになった) ので今度は逆に常に絶対パスを表示する手段を提供したい
- [x] `TraitItem` と `Item::Const` への対応
  - [x] 実装
  - [x] テスト
- [ ] 現在の実装では関数の返り値型が `Result` 型で**ない**時でも最後の式が `Ok` / `Err` であればフックしてしまう。
  - しかし、例えば `Result<T, E>` 型ではなく `MyResult<T>` だったりした際のフックを考えるとむしろこちらの仕様の方が親切で、 `#[hooq::skip]` で対応させる方が正しいのではないかという気持ちもある
  - feature や属性オプションを再考する際に存在だけ思い出してほしいかも
  - ↑ 上述に伴い、 feature で各ハードコードをコンフィグ可能にする
    - [ ] `?` にフックするか否か
    - [ ] `return xxx;` にフックするか否か
    - [ ] 関数の最後の評価値にフックするか否か
    - [ ] 返り値の式が `Ok(...)` ・ `Err(...)` ・ `Xxx(...)` の時にはフックするといった設定ができるか
    - [ ] 関数の返り値型が `Result` ではない( `MyResult` などである)時にもフックするといった設定ができるか
    - [ ] マクロの中身まで見るか (デフォルト: 見る)
- [ ] `tag` とほぼ同じ機能で `message` を入れる...？
  - というかいっそこちらで予約していない変数は自由に入れられるようにするか
  - `#[hooq::hoge("")]` == `#[hooq::var(hoge = "")]` みたいな機能にしてみる
- [ ] (公開後でいい) examples 以下の内容も expand 自動化
- [ ] `$parent_method` でメソッド上書き時に元のメソッドも活用できるようにする
- [x] `cargo sort` をCIに入れる
- [x] `cargo build --timings html` の検討及び良さそうであればCIに入れる
- [ ] (公開後でいい) `$expr` の出力する情報が多いので、出力を控えたものも用意する